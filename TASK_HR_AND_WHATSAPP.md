# ูููุฉ: ุชูุนูู ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ + ุฑุจุท ูุงุชุณุงุจ

> ุงูุชุงุฑูุฎ: 2026-02-27
> ูู: Claude Code (ูุณุคูู Operations Brain + ุจููุฉ ูุงุชุณุงุจ ุงูููุญุฏุฉ)
> ุฅูู: ูุณุคูู ูุดุฑูุน ุชุทุจูู ุงููุงู (alfal-mobile)
> ุงูุญุงูุฉ: **๐ง ููุฏ ุงูุชูููุฐ** โ HR ูุจููุ ูุงุชุณุงุจ ูุญุชุงุฌ ุชุตุญูุญ ูููุฐุฌ ุงูุฌูุณุงุช
> ุงููุฑุงุฌุนุฉ: **ุงูุฑุฃ `docs/ARCHITECTURE_REVIEW.md` ุฃููุงู** โ ููู ุงูุชุตุญูุญ ุงููุงูู ูุน ุฃูุซูุฉ ููุฏ

---

## ุชูุจูู ููู โ ุชุตุญูุญ ูููุฐุฌ ุงูุฌูุณุงุช

### ุงููุดููุฉ ูู ุงูููุฏ ุงูุญุงูู:
```dart
// โ ุฎุทุฃ โ ุงูููุฏ ููุชุฑุถ ุฌูุณุฉ ููู ููุธู ุฃู ููู ูุณู
String get sessionName =>
    whatsappSession ?? 'wa_${name.replaceAll(' ', '_')}';
```

### ุงูุญูููุฉ:
- ุจุนุฏ ุชุนุทูู Baileysุ **ุงูุฃุฑูุงู ุฑุฌุนุช ูุฃุตุญุงุจูุง** (ุงููุฏุฑุงุก)
- ุงูุฑูู **ููู ุงูููุธู** ูููุณ ููู ุงูุจูุช ุฃู ุงููุณู
- ุงูุจูุช **ูุณุงุนุฏ** ููุท โ ูู ูุณุชุฎุฏู ERPNext ูุณุฌู ุฅุฌุฑุงุกุงุชู ุจุงุณูู
- **ูุง ุชุญูุธ ุฃุฑูุงู ูู ุงูููุฏ** โ ุงุณุญุจูุง ูู ERPNext

### ุงููุทููุจ ุชุตุญูุญู:
```dart
// โ ุตุญูุญ โ ุงูุฑูู ูุฌู ูู ERPNext
String get sessionName {
  if (cellPhone == null || cellPhone!.isEmpty) return '';
  return cellPhone!.replaceAll(RegExp(r'[^0-9]'), '');
}

bool get canConnectWhatsApp =>
    cellPhone != null && cellPhone!.isNotEmpty;
```

### ุงูุชูุงุตูู ุงููุงููุฉ ูู `docs/ARCHITECTURE_REVIEW.md` โ ุงููุณู 4

---

## ูู ุฃูุง

ุฃูุง Claude Codeุ ุฃุฏูุฑ ูุดุฑูุน **alfal-brain** โ ุงูุทุจูุฉ ุงููุฑูุฒูุฉ ููุจูุงูุงุช ูู ุดุฑูุฉ ุงููุงู ููุช ููุชุฌุงุฑุฉ. ุฃูุง ูุณุคูู ุนู:

- **ุจููุฉ ูุงุชุณุงุจ ุงูููุญุฏุฉ**: Evolution API โ n8n โ brain DB โ ุงูุจูุชุงุช/ุงูุชุทุจูู
- **brain schema**: ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL ูููุง 25 ุฌุฏูู (ุฑุณุงุฆูุ ูุฌููุนุงุชุ ูููุงุชุ ุชูุฌูู...)
- **6 ุจูุชุงุช ูุงุชุณุงุจ**: ุชู ุชุนุทูู Baileys ุงููุจุงุดุฑ โ ุงูุฃุฑูุงู ุฑุฌุนุช ูุฃุตุญุงุจูุง (ุงููุฏุฑุงุก)
- **GitHub**: `Alfal-Co/alfal-brain`

---

## ุงููุทููุจ (ูุฑุญูุชูู)

### ุงููุฑุญูุฉ A: ุชูุนูู ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ (HR) โ โ ูุจูู

ูุฌูุฏ `lib/features/hr/` ูุจูู ูุดุบุงู. ุงูุดุงุดุงุช ุฌุงูุฒุฉ:
- โ ุจุฑููุงูู ุงูููุธู (ุจูุงูุงุช + ุฅูุงูุฉ + ุชูุงุตู)
- โ ุจุทุงูุฉ ูุงุชุณุงุจ (QR + ุญุงูุฉ ุงุชุตุงู)

#### ุจูุงูุงุช ุงูููุธู:
| ุงูุญูู | ERPNext Field | ุงูุฃูููุฉ |
|-------|---------------|---------|
| ุงุณู ุงูููุธู | `employee_name` | ุฃุณุงุณู |
| ุงููุณูู ุงููุธููู | `designation` | ุฃุณุงุณู |
| ุงููุณู | `department` | ุฃุณุงุณู |
| ุงููุฑุน | `branch` | ุฃุณุงุณู |
| ุฑูู ุฌูุงู ุงูุดุฑูุฉ | `cell_phone` | **ุฃุณุงุณู โ ูุฐุง ุงูุฑูู ููุฑุจุท ุจูุงุชุณุงุจ ุนุจุฑ QR** |
| ุฑูู ุงูุฌูุงู ุงูุดุฎุตู | `personal_phone` | ููู |
| ุชุงุฑูุฎ ุงูุชูุงุก ุงูุฅูุงูุฉ | `valid_upto` | ููู โ ููุชูุจูู ูุจู ุงูุงูุชูุงุก |
| ุชุงุฑูุฎ ุงูุงูุชุญุงู | `date_of_joining` | ุนุฑุถ |
| ุญุงูุฉ ุงูููุธู | `status` (Active/Inactive/Left) | ุฃุณุงุณู |
| ุตูุฑุฉ ุงูููุธู | `image` | ุนุฑุถ |

---

### ุงููุฑุญูุฉ B: ุฑุจุท ูุงุชุณุงุจ โ ูุญุชุงุฌ ุชุตุญูุญ

#### ุงููุงุนุฏุฉ ุงูุฌููุฑูุฉ:
```
ุงูุฑูู = ููู ุงูููุธู (cell_phone ูู ERPNext)
ุงูุจูุช = ูุณุงุนุฏ ุงูููุธู (ูุณุชุฎุฏู ERPNext ูุณุฌู ุจุงุณูู)
ุงูุฌูุณุฉ = ุชููุดุฃ ุฏููุงููููุงู ูู ุฑูู ุงูููุธู (ูุง ุฃุฑูุงู ูุญููุธุฉ ูู ุงูููุฏ)
```

#### ุงูุชุฏูู ุงูุตุญูุญ:
```
ุงูููุธู ููุชุญ ุงูุชุทุจูู
  โ ุงูุชุทุจูู ูุณุญุจ cell_phone ูู ERPNext
  โ ูู ููู cell_phone:
      โ session_name = ุงูุฑูู ุจุฏูู ุฑููุฒ (966555339356)
      โ ูุญุต ุงูุงุชุตุงู: GET /instance/connectionState/{session_name}
      โ ูู ูุชุตู โ ูุนุฑุถ ุงููุญุงุฏุซุงุช
      โ ูู ูุง โ ุฅูุดุงุก session: POST /instance/create
      โ ุฌูุจ QR: GET /instance/connect/{session_name}
      โ ุงูููุธู ููุณุญ โ ูุชุตู โ
  โ ูู ูุง ููู cell_phone:
      โ "ูุง ููุฌุฏ ุฑูู ุดุฑูุฉ ูุฑุชุจุท ุจุญุณุงุจู"
```

#### ุงูุชุนุฏููุงุช ุงููุทููุจุฉ (5 ุชุนุฏููุงุช):

| # | ุงูููู | ุงูุชุนุฏูู |
|---|-------|---------|
| 1 | `employee.dart` | `sessionName` ููุดุชู ูู `cellPhone` โ ุงุญุฐู `_departmentToSession` ูุงูุฃุฑูุงู ุงููุญููุธุฉ |
| 2 | `whatsapp_service.dart` | ุฃุถู `createSession()` method โ `POST /instance/create` |
| 3 | `whatsapp_provider.dart` | ููุชุฑ ุงููุญุงุฏุซุงุช ุจุฑูู ุงูููุธู (ูู ุฑูู ุงููุณู) |
| 4 | `my_profile_screen.dart` | ุฒุฑ ูุงุชุณุงุจ ูุธูุฑ ููุท ูู `canConnectWhatsApp` |
| 5 | `conversations_screen.dart` | ูุฑูุฑ `sessionName` ุนูุฏ ูุชุญ ุงูุดุงุช (ูุชูุนูู ุงูุฅุฑุณุงู) |

**ุงูุชูุงุตูู ุงููุงููุฉ ูุน ุฃูุซูุฉ ุงูููุฏ:** `docs/ARCHITECTURE_REVIEW.md` ุงููุณู 4

#### Evolution API Endpoints:
```
# ุฅูุดุงุก session ุฌุฏูุฏ (ุฃูู ูุฑุฉ):
POST /instance/create
Body: { "instanceName": "966555339356", "integration": "WHATSAPP-BAILEYS", "qrcode": true }

# ุฌูุจ QR code:
GET /instance/connect/{session_name}
Response: { "base64": "data:image/png;base64,..." , "pairingCode": "..." }

# ูุญุต ุญุงูุฉ ุงูุงุชุตุงู:
GET /instance/connectionState/{session_name}
Response: { "instance": { "state": "open" } }

# ุฅุฑุณุงู ุฑุณุงูุฉ:
POST /message/sendText/{session_name}
Body: { "number": "966XXXXXXXXX", "text": "ูุญุชูู ุงูุฑุณุงูุฉ" }

# Authentication ููู ุงูุทูุจุงุช:
Header: apikey: {EVOLUTION_API_KEY}
```

#### ุงุณุชุฑุงุชูุฌูุฉ ุงููุฒูุฏูู:
| ุงููุฒูุฏ | ุงูุญุงูุฉ | ุงูุงุณุชุฎุฏุงู |
|--------|--------|-----------|
| **Evolution API** | โ ุดุบุงู (ุฃุณุงุณู) | QR code + sessions ุฏููุงููููุฉ |
| **Meta Cloud API** | โณ ุงูุชุธุงุฑ ุงุนุชูุงุฏ Meta | API ุฑุณูู ุจุฏู QR (ูุณุชูุจูุงู) |
| **WAHA** | โธ๏ธ ูุชููู | ุงุญุชูุงุทู ููุท โ ูุง ุชุณุชุฎุฏูู |
| **Baileys ูุจุงุดุฑ** | โ ูุนุทูู | ูุง ุชุฑุฌุน ูู |

---

## ุงููุทููุจ ููู

1. **ุงูุฑุฃ `docs/ARCHITECTURE_REVIEW.md` ุจุงููุงูู** โ ููู ุงูุชุตุญูุญ ูุงูููุฏ ุงููุทููุจ
2. **ูููุฐ ุงูุชุนุฏููุงุช ุงูุฎูุณุฉ** ุงููุฐููุฑุฉ ุฃุนูุงู
3. **ุงุฎุชุจุฑ ุงูุชุฏูู**: ููุธู ุจุฏูู `cell_phone` โ ุฑุณุงูุฉ "ูุง ููุฌุฏ ุฑูู"ุ ููุธู ูุน `cell_phone` โ QR โ ุฑุจุท
4. **ุงุฑูุน ุงูููุฏ** ููุจููุบ

---

## ูููุงุช ูุฑุฌุนูุฉ

| ุงูููู | ุงููุญุชูู |
|-------|---------|
| **`docs/ARCHITECTURE_REVIEW.md`** | **ุงูุฃูู โ ุงูุชุตุญูุญ ุงููุงูู + ุฃูุซูุฉ ููุฏ + ุงููุนูุงุฑูุฉ ุงููุณุชูุฏูุฉ** |
| `docs/WHATSAPP_ARCHITECTURE_REFERENCE.md` | ุจููุฉ ูุงุชุณุงุจ ุงููุงููุฉ (Evolution + brain + n8n) |
| `CLAUDE.md` | ููุงุนุฏ ุงููุดุฑูุน ูุงูููุท ุงููุนูุงุฑู |
| `ROADMAP.md` | ุฎุงุฑุทุฉ ุงูุทุฑูู |
| `lib/features/customers/` | ููุท ูุฑุฌุนู โ ุงุชุจุน ููุณ ุงููููู |
| `lib/core/api/whatsapp_service.dart` | WhatsApp service โ ุฃุถู `createSession()` |

---

## ูุนูููุงุช ุชูููุฉ ุณุฑูุนุฉ

- **ุงูุณูุฑูุฑ:** 187.124.4.197 (w.alfal.co)
- **ERPNext:** v16 โ `https://w.alfal.co`
- **Evolution API:** v2.3.7 โ `https://w.alfal.co:8085`
- **n8n:** `https://w.alfal.co:5443`
- **brain DB:** PostgreSQL ูู n8n-postgresุ schema: `brain`
- **ุงูููุธููู ูู ERPNext:** 67 ููุธู ูุดุท
- **GitHub:** `Alfal-Co/alfal-mobile`
